<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#ffffff" />
  <title>impactOS Dashboard</title>
  
  <style>
    
    * { box-sizing: border-box; }
    
    :root {
      --bg-gradient-1: #84d0f5;
      --bg-gradient-2: #fdc42a;
      --bg-gradient-3: #f39200;
      --bg-gradient-4: #e4022b;
      --bg-gradient-5: #ae2146;
      
      --glass-bg: rgba(255, 255, 255, 0.4);
      --glass-border: rgba(255, 255, 255, 0.6);
      --glass-shadow: rgba(31, 38, 135, 0.12);
      
      --text-primary: #1d1d1f;
      --text-secondary: #6e6e73;
      --text-tertiary: #b0b0b5;
      
      --accent: #007aff;
      --accent-gradient-1: #007aff;
      --accent-gradient-2: #00d4ff;
      --accent-gradient-3: #a855f7;
      
      --success: #34c759;
      --success-light: #d1f4da;
      
      --blur-sm: blur(30px);
      --blur-md: blur(50px);
      --blur-lg: blur(80px);
      
      --shadow-glass: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
      --shadow-float: 0 12px 48px 0 rgba(31, 38, 135, 0.1);
    }
    
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
    }
    
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", "Helvetica Neue", Arial, sans-serif;
      background: #ffffff;
      position: relative;
      color: var(--text-primary);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      font-size: 17px;
      line-height: 1.47059;
      font-weight: 400;
      letter-spacing: -0.022em;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    
    body::before {
      content: '';
      position: fixed;
      right: -35%;
      top: -20%;
      width: 150%;
      height: 140%;
      background: 
        radial-gradient(circle at 95% 5%, var(--bg-gradient-1) 0%, transparent 24%),
        radial-gradient(circle at 82% 10%, var(--bg-gradient-1) 0%, transparent 22%),
        radial-gradient(circle at 92% 18%, var(--bg-gradient-2) 0%, transparent 20%),
        radial-gradient(circle at 75% 15%, var(--bg-gradient-1) 0%, transparent 23%),
        radial-gradient(circle at 88% 25%, var(--bg-gradient-3) 0%, transparent 18%),
        radial-gradient(circle at 68% 20%, var(--bg-gradient-1) 0%, transparent 21%),
        radial-gradient(circle at 96% 32%, var(--bg-gradient-4) 0%, transparent 19%),
        radial-gradient(circle at 78% 28%, var(--bg-gradient-2) 0%, transparent 17%),
        radial-gradient(circle at 85% 38%, var(--bg-gradient-1) 0%, transparent 24%),
        radial-gradient(circle at 72% 35%, var(--bg-gradient-5) 0%, transparent 20%),
        radial-gradient(circle at 94% 45%, var(--bg-gradient-3) 0%, transparent 18%),
        radial-gradient(circle at 80% 48%, var(--bg-gradient-1) 0%, transparent 22%),
        radial-gradient(circle at 65% 42%, var(--bg-gradient-2) 0%, transparent 19%),
        radial-gradient(circle at 90% 55%, var(--bg-gradient-4) 0%, transparent 20%),
        radial-gradient(circle at 75% 58%, var(--bg-gradient-1) 0%, transparent 23%),
        radial-gradient(circle at 82% 65%, var(--bg-gradient-3) 0%, transparent 18%),
        radial-gradient(circle at 68% 62%, var(--bg-gradient-1) 0%, transparent 21%),
        radial-gradient(circle at 98% 72%, var(--bg-gradient-5) 0%, transparent 20%),
        radial-gradient(circle at 88% 78%, var(--bg-gradient-2) 0%, transparent 22%),
        radial-gradient(circle at 72% 75%, var(--bg-gradient-1) 0%, transparent 24%),
        radial-gradient(circle at 92% 85%, var(--bg-gradient-4) 0%, transparent 19%),
        radial-gradient(circle at 78% 88%, var(--bg-gradient-1) 0%, transparent 22%),
        radial-gradient(circle at 85% 92%, var(--bg-gradient-3) 0%, transparent 18%),
        radial-gradient(circle at 60% 12%, var(--bg-gradient-1) 0%, transparent 20%),
        radial-gradient(circle at 55% 28%, var(--bg-gradient-2) 0%, transparent 19%),
        radial-gradient(circle at 48% 22%, var(--bg-gradient-1) 0%, transparent 21%),
        radial-gradient(circle at 70% 52%, var(--bg-gradient-4) 0%, transparent 18%),
        radial-gradient(circle at 58% 45%, var(--bg-gradient-1) 0%, transparent 22%),
        radial-gradient(circle at 62% 68%, var(--bg-gradient-3) 0%, transparent 20%),
        radial-gradient(circle at 52% 58%, var(--bg-gradient-1) 0%, transparent 21%),
        radial-gradient(circle at 65% 82%, var(--bg-gradient-2) 0%, transparent 22%),
        radial-gradient(circle at 45% 38%, var(--bg-gradient-1) 0%, transparent 19%);
      opacity: 0.95;
      filter: blur(25px);
      z-index: 0;
      pointer-events: none;
      animation: bubbleFloat 25s ease-in-out infinite;
    }
    
    @keyframes bubbleFloat {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-30px);
      }
    }
    
    .app {
      position: relative;
      z-index: 1;
    }
    
    .version-badge {
      font-size: 10px;
      font-weight: 500;
      color: var(--text-tertiary);
      letter-spacing: 0.05em;
      padding: 4px 8px;
      background: rgba(0, 0, 0, 0.05);
      border-radius: 6px;
    }
    
    /* Modern display corners - macOS/iPad style */
    .screen-corner {
      position: fixed;
      width: 96px;
      height: 96px;
      z-index: 9999;
      pointer-events: none;
    }
    
    .screen-corner.top-left {
      top: 0;
      left: 0;
    }
    
    .screen-corner.top-right {
      top: 0;
      right: 0;
    }
    
    .screen-corner.bottom-left {
      bottom: 0;
      left: 0;
    }
    
    .screen-corner.bottom-right {
      bottom: 0;
      right: 0;
    }
    
    /* ============================================
       Layout
       ============================================ */
    
    .app {
      display: grid;
      grid-template-rows: auto 1fr;
      grid-template-columns: 420px 1fr;
      height: 100dvh;
    }
    
    .app .navbar {
      grid-column: 1 / -1;
    }
    
    .app .main {
      grid-column: 1 / -1;
      opacity: 1;
      transition: opacity 1.4s ease-in-out, 
                  grid-column 0s linear 1.4s;
    }
    
    .app:not(.with-product-view) .main {
      opacity: 0;
    }
    
    .app.with-product-view .main {
      grid-column: 2;
      opacity: 1;
      transition: opacity 1.4s ease-in-out 1.4s, 
                  grid-column 0s linear 1.4s;
    }
    
    /* Navigation bar - Transparent */
    .navbar {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 32px 48px;
      background: transparent;
      z-index: 200;
    }
    
    .location-info {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }
    
    .location-label {
      font-size: 11px;
      font-weight: 500;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 4px;
    }
    
    .location-title {
      font-size: 17px;
      font-weight: 600;
      color: var(--text-primary);
      letter-spacing: -0.01em;
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .brand-logo {
      height: 55px;
      display: block;
    }
    
    .brand-text {
      display: none;
    }
    
    .nav-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .icon-btn {
      position: relative;
      width: 44px;
      height: 44px;
      border-radius: 12px;
      background: 
        linear-gradient(165deg, rgba(255, 255, 255, 0.5) 0%, rgba(255, 255, 255, 0.3) 100%);
      backdrop-filter: blur(30px) saturate(180%);
      -webkit-backdrop-filter: blur(30px) saturate(180%);
      border: 1px solid transparent;
      display: grid;
      place-items: center;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      color: var(--text-primary);
      font-size: 20px;
      box-shadow: 
        0 4px 16px rgba(31, 38, 135, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.9),
        inset 0 0 0 1px rgba(255, 255, 255, 0.7);
    }
    
    .icon-btn:hover {
      background: rgba(255, 255, 255, 0.4);
      transform: translateY(-2px);
      box-shadow: var(--shadow-float);
    }
    
    .icon-btn:active {
      transform: scale(0.96) translateY(0);
    }
    
    /* Main content area */
    .main {
      overflow-y: auto;
      overflow-x: hidden;
      padding: 20px 16px;
      -webkit-overflow-scrolling: touch;
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .app.with-product-view .main {
      padding-left: 24px;
    }
    
    .container {
      max-width: 100%;
      margin: 0 auto;
    }
    
    .app.with-product-view .container {
      max-width: 1400px;
    }
    
    /* ============================================
       Cycle Status - Hidden (using product overlay instead)
       ============================================ */
    
    .status-banner {
      display: none !important;
    }
    
    .status-banner::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, 
        rgba(0, 122, 255, 0.05) 0%, 
        rgba(168, 85, 247, 0.05) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .status-banner.active {
      display: flex;
    }
    
    .status-banner.running::before {
      opacity: 1;
    }
    
    .status-banner.success {
      background: linear-gradient(135deg, 
        rgba(52, 199, 89, 0.15) 0%, 
        rgba(48, 209, 88, 0.08) 100%);
      border-color: rgba(52, 199, 89, 0.3);
    }
    
    .status-banner.success::before {
      opacity: 0;
    }
    
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Waveform Animation */
    .waveform {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      height: 60px;
    }
    
    .waveform-bar {
      width: 4px;
      background: linear-gradient(180deg, var(--accent-gradient-1), var(--accent-gradient-2));
      border-radius: 2px;
      animation: wave 1.2s ease-in-out infinite;
      box-shadow: 0 0 8px rgba(0, 122, 255, 0.4);
    }
    
    .waveform-bar:nth-child(1) { animation-delay: 0s; }
    .waveform-bar:nth-child(2) { animation-delay: 0.1s; }
    .waveform-bar:nth-child(3) { animation-delay: 0.2s; }
    .waveform-bar:nth-child(4) { animation-delay: 0.3s; }
    .waveform-bar:nth-child(5) { animation-delay: 0.4s; }
    .waveform-bar:nth-child(6) { animation-delay: 0.5s; }
    .waveform-bar:nth-child(7) { animation-delay: 0.4s; }
    .waveform-bar:nth-child(8) { animation-delay: 0.3s; }
    .waveform-bar:nth-child(9) { animation-delay: 0.2s; }
    .waveform-bar:nth-child(10) { animation-delay: 0.1s; }
    
    @keyframes wave {
      0%, 100% { height: 12px; }
      50% { height: 52px; }
    }
    
    .status-text {
      font-size: 24px;
      font-weight: 700;
      letter-spacing: -0.03em;
      color: var(--text-primary);
      text-align: center;
    }
    
    .status-subtext {
      font-size: 17px;
      font-weight: 500;
      color: var(--text-secondary);
      text-align: center;
    }
    
    /* Success checkmark animation */
    .success-icon {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--success), #30d158);
      display: grid;
      place-items: center;
      font-size: 48px;
      color: white;
      box-shadow: 
        0 8px 32px rgba(52, 199, 89, 0.4),
        inset 0 2px 4px rgba(255, 255, 255, 0.3);
      animation: successPop 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    
    @keyframes successPop {
      0% {
        transform: scale(0);
        opacity: 0;
      }
      50% {
        transform: scale(1.1);
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }
    
    .spinner {
      width: 24px;
      height: 24px;
      border: 3px solid rgba(0, 122, 255, 0.2);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* ============================================
       Hero Metrics Grid
       ============================================ */
    
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 18px;
      margin-bottom: 16px;
    }
    
    .metric-card.alternating {
      transition: opacity 1s ease-in-out, filter 1s ease-in-out;
    }
    
    .metric-card.alternating.transitioning {
      opacity: 0;
      filter: blur(10px);
    }
    
    .metric-card {
      position: relative;
      background: 
        linear-gradient(165deg, rgba(255, 255, 255, 0.5) 0%, rgba(255, 255, 255, 0.3) 100%);
      backdrop-filter: blur(50px) saturate(180%);
      -webkit-backdrop-filter: blur(50px) saturate(180%);
      border: 1.5px solid transparent;
      border-radius: 22px;
      padding: 26px;
      box-shadow: 
        0 8px 32px rgba(31, 38, 135, 0.12),
        0 2px 8px rgba(0, 0, 0, 0.06),
        inset 0 0 0 1px rgba(255, 255, 255, 0.8),
        inset 0 1px 0 0 rgba(255, 255, 255, 0.9),
        inset 0 -1px 0 0 rgba(0, 0, 0, 0.02);
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .metric-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.15) 0%, transparent 50%);
      pointer-events: none;
      opacity: 0.8;
    }
    
    .metric-card::after {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 20px;
      padding: 1.5px;
      background: linear-gradient(165deg, 
        rgba(255, 255, 255, 0.9) 0%, 
        rgba(255, 255, 255, 0.4) 50%, 
        rgba(255, 255, 255, 0.1) 100%);
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events: none;
    }
    
    .metric-card:hover {
      transform: translateY(-4px);
      box-shadow: 
        0 12px 48px rgba(31, 38, 135, 0.15),
        0 4px 16px rgba(0, 0, 0, 0.08),
        inset 0 0 0 1px rgba(255, 255, 255, 0.9),
        inset 0 1px 0 0 rgba(255, 255, 255, 1),
        inset 0 -1px 0 0 rgba(0, 0, 0, 0.03);
    }
    
    .metric-card > * {
      position: relative;
      z-index: 1;
    }
    
    .metric-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, 
        var(--accent-gradient-1), 
        var(--accent-gradient-2), 
        var(--accent-gradient-3));
      opacity: 0;
      transition: opacity 0.4s ease;
    }
    
    .metric-card.highlight {
      animation: cardPulse 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .metric-card.highlight::before {
      opacity: 1;
    }
    
    @keyframes cardPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }
    
    .metric-label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin-bottom: 8px;
      position: relative;
    }
    
    .cycle-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      padding: 4px 10px;
      background: linear-gradient(135deg, #34c759, #30d158);
      color: white;
      font-size: 11px;
      font-weight: 700;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(52, 199, 89, 0.4);
      opacity: 0;
      transform: scale(0.8) translateY(-4px);
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    .cycle-badge.show {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
    
    .metric-value {
      font-size: 42px;
      font-weight: 700;
      letter-spacing: -0.04em;
      color: var(--text-primary);
      line-height: 1.1;
      margin-bottom: 10px;
    }
    
    
    
    /* ============================================
       Info Panels
       ============================================ */
    
    .panel {
      position: relative;
      background: 
        linear-gradient(165deg, rgba(255, 255, 255, 0.5) 0%, rgba(255, 255, 255, 0.3) 100%);
      backdrop-filter: blur(50px) saturate(180%);
      -webkit-backdrop-filter: blur(50px) saturate(180%);
      border: 1.5px solid transparent;
      border-radius: 24px;
      padding: 32px;
      margin-bottom: 28px;
      box-shadow: 
        0 8px 32px rgba(31, 38, 135, 0.12),
        0 2px 8px rgba(0, 0, 0, 0.06),
        inset 0 0 0 1px rgba(255, 255, 255, 0.8),
        inset 0 1px 0 0 rgba(255, 255, 255, 0.9),
        inset 0 -1px 0 0 rgba(0, 0, 0, 0.02);
    }
    
    .panel::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.15) 0%, transparent 50%);
      pointer-events: none;
      opacity: 0.8;
      z-index: 0;
    }
    
    .panel::after {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 24px;
      padding: 1.5px;
      background: linear-gradient(165deg, 
        rgba(255, 255, 255, 0.9) 0%, 
        rgba(255, 255, 255, 0.4) 50%, 
        rgba(255, 255, 255, 0.1) 100%);
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events: none;
      z-index: 0;
    }
    
    .panel > * {
      position: relative;
      z-index: 1;
    }
    
    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    
    .panel-title {
      font-size: 24px;
      font-weight: 700;
      letter-spacing: -0.03em;
      color: var(--text-primary);
      margin: 0;
    }
    
    .panel-subtitle {
      font-size: 15px;
      color: var(--text-secondary);
      font-weight: 500;
    }
    
    .stats-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .stat-item {
      padding: 20px;
      background: rgba(255, 255, 255, 0.5);
      backdrop-filter: var(--blur-sm);
      -webkit-backdrop-filter: var(--blur-sm);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.6);
      box-shadow: 0 4px 16px rgba(31, 38, 135, 0.08);
    }
    
    .stat-label {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 6px;
      font-weight: 500;
    }
    
    .stat-value {
      font-size: 28px;
      font-weight: 700;
      letter-spacing: -0.03em;
      color: var(--text-primary);
    }
    
    /* ============================================
       Product Showcase (Left Side)
       ============================================ */
    
    .product-showcase {
      position: fixed;
      left: 0;
      top: 119px;
      bottom: 0;
      width: 420px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      padding: 10px 32px 24px 32px;
      z-index: 50;
      opacity: 0;
      visibility: hidden;
      transition: opacity 1.4s ease-in-out 1.4s, 
                  visibility 0s linear 1.4s;
    }
    
    .product-showcase.show {
      opacity: 1;
      visibility: visible;
    }
    
    .product-image-container {
      width: 100%;
      max-width: 300px;
      position: relative;
      margin-top: -30px;
    }
    
    .product-status-overlay {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      opacity: 1;
      transition: opacity 0.4s ease;
      z-index: 100;
    }
    
    .product-waveform {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 3px;
      height: 40px;
      animation: waveformFadeIn 0.6s ease-out;
    }
    
    @keyframes waveformFadeIn {
      from {
        opacity: 0;
        transform: translateY(8px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .product-status-text {
      font-size: 13px;
      font-weight: 600;
      color: #6e6e73;
      letter-spacing: 0.02em;
      animation: textFadeIn 0.6s ease-out 0.3s both;
    }
    
    @keyframes textFadeIn {
      from {
        opacity: 0;
        transform: translateY(4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .product-wave-bar {
      width: 4px;
      background: linear-gradient(180deg, 
        rgba(0, 122, 255, 0.9), 
        rgba(0, 212, 255, 0.9));
      border-radius: 2px;
      box-shadow: 0 0 10px rgba(0, 122, 255, 0.4);
      opacity: 0.8;
    }
    
    .product-wave-bar.active {
      animation: productWave 1.4s ease-in-out infinite;
      opacity: 1;
    }
    
    .product-wave-bar:nth-child(1) { animation-delay: 0s; height: 12px; }
    .product-wave-bar:nth-child(2) { animation-delay: 0.15s; height: 16px; }
    .product-wave-bar:nth-child(3) { animation-delay: 0.3s; height: 24px; }
    .product-wave-bar:nth-child(4) { animation-delay: 0.45s; height: 32px; }
    .product-wave-bar:nth-child(5) { animation-delay: 0.6s; height: 36px; }
    .product-wave-bar:nth-child(6) { animation-delay: 0.75s; height: 32px; }
    .product-wave-bar:nth-child(7) { animation-delay: 0.6s; height: 24px; }
    .product-wave-bar:nth-child(8) { animation-delay: 0.45s; height: 16px; }
    .product-wave-bar:nth-child(9) { animation-delay: 0.3s; height: 12px; }
    
    .product-wave-bar.idle {
      animation: none;
      height: 4px;
      opacity: 0.6;
    }
    
    @keyframes productWave {
      0%, 100% { 
        transform: scaleY(1);
      }
      25% {
        transform: scaleY(1.15);
      }
      50% { 
        transform: scaleY(1.25);
      }
      75% {
        transform: scaleY(1.15);
      }
    }
    
    .product-checkmark {
      width: 36px;
      height: 36px;
      position: relative;
    }
    
    .check-circle {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, #34c759, #30d158);
      box-shadow: 
        0 4px 16px rgba(52, 199, 89, 0.4),
        inset 0 1px 2px rgba(255, 255, 255, 0.4);
      animation: circleExpand 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .check-path {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 18px;
      height: 18px;
      transform: translate(-50%, -50%);
    }
    
    .check-path svg {
      width: 100%;
      height: 100%;
    }
    
    .check-path path {
      fill: none;
      stroke: white;
      stroke-width: 3;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-dasharray: 24;
      stroke-dashoffset: 24;
      animation: checkDraw 0.4s cubic-bezier(0.4, 0, 0.2, 1) 0.2s forwards;
    }
    
    @keyframes circleExpand {
      0% {
        transform: scale(0);
        opacity: 0;
      }
      60% {
        transform: scale(1.1);
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }
    
    @keyframes checkDraw {
      to {
        stroke-dashoffset: 0;
      }
    }
    
    .product-image {
      width: 100%;
      height: auto;
      mask-image: radial-gradient(ellipse 85% 80% at center, 
        black 25%, 
        rgba(0, 0, 0, 0.6) 50%, 
        rgba(0, 0, 0, 0.2) 75%,
        transparent 100%);
      -webkit-mask-image: radial-gradient(ellipse 85% 80% at center, 
        black 25%, 
        rgba(0, 0, 0, 0.6) 50%, 
        rgba(0, 0, 0, 0.2) 75%,
        transparent 100%);
    }
    
    .product-badge {
      text-align: center;
      padding: 4px;
      font-size: 11px;
      font-weight: 500;
      color: var(--text-secondary);
      width: 100%;
      max-width: 280px;
      margin-bottom: 16px;
    }
    
    
    /* ============================================
       Settings Panel
       ============================================ */
    
    .settings-panel {
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      width: min(90vw, 520px);
      background: var(--glass-bg);
      backdrop-filter: var(--blur-lg);
      -webkit-backdrop-filter: var(--blur-lg);
      border-left: 2px solid var(--glass-border);
      box-shadow: var(--shadow-float);
      z-index: 300;
      transform: translateX(100%);
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      display: grid;
      grid-template-rows: auto 1fr auto;
    }
    
    .settings-panel.open {
      transform: translateX(0);
    }
    
    .settings-header {
      padding: 24px 28px;
      border-bottom: 1.5px solid rgba(255, 255, 255, 0.3);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .settings-title {
      font-size: 24px;
      font-weight: 700;
      letter-spacing: -0.03em;
      margin: 0;
    }
    
    .settings-body {
      overflow-y: auto;
      padding: 24px;
      -webkit-overflow-scrolling: touch;
    }
    
    .settings-footer {
      padding: 20px 24px;
      border-top: 0.5px solid var(--divider);
      display: flex;
      gap: 12px;
    }
    
    .form-section {
      margin-bottom: 28px;
    }
    
    .form-section-title {
      font-size: 17px;
      font-weight: 600;
      margin: 0 0 12px 0;
      color: var(--text-primary);
    }
    
    .form-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 0.5px solid var(--divider);
    }
    
    .form-row:last-child {
      border-bottom: none;
    }
    
    .form-label {
      font-size: 15px;
      color: var(--text-primary);
      font-weight: 500;
    }
    
    .form-input {
      background: var(--bg-elevated);
      border: 1px solid var(--divider);
      border-radius: 10px;
      padding: 8px 12px;
      font-size: 15px;
      color: var(--text-primary);
      width: 120px;
      text-align: right;
      font-family: inherit;
      transition: border-color 0.2s ease;
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    /* ============================================
       Buttons
       ============================================ */
    
    .btn {
      padding: 14px 28px;
      border-radius: 14px;
      font-size: 16px;
      font-weight: 600;
      letter-spacing: -0.02em;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: none;
      font-family: inherit;
      flex: 1;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--accent-gradient-1), var(--accent-gradient-2));
      color: white;
      box-shadow: 
        var(--shadow-glass),
        inset 0 1px 1px rgba(255, 255, 255, 0.3);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-float);
    }
    
    .btn-primary:active {
      transform: scale(0.98) translateY(0);
    }
    
    .btn-secondary {
      background: var(--glass-bg);
      backdrop-filter: var(--blur-sm);
      -webkit-backdrop-filter: var(--blur-sm);
      color: var(--text-primary);
      border: 1.5px solid var(--glass-border);
      box-shadow: var(--shadow-glass);
    }
    
    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.4);
      transform: translateY(-2px);
      box-shadow: var(--shadow-float);
    }
    
    .btn-secondary:active {
      transform: scale(0.98) translateY(0);
    }
    
    .btn-text {
      background: transparent;
      border: none;
      color: var(--accent);
      padding: 0;
      font-weight: 600;
      font-size: 17px;
      letter-spacing: -0.01em;
      cursor: pointer;
      transition: all 0.15s ease;
      font-family: inherit;
    }
    
    .btn-text:active {
      opacity: 0.4;
      transform: scale(0.96);
    }
    
    /* ============================================
       Toast Notification
       ============================================ */
    
    .toast {
      position: fixed;
      bottom: 48px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--glass-bg);
      backdrop-filter: var(--blur-lg);
      -webkit-backdrop-filter: var(--blur-lg);
      padding: 16px 32px;
      border-radius: 100px;
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      box-shadow: var(--shadow-float);
      border: 1.5px solid var(--glass-border);
      opacity: 0;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 400;
    }
    
    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    
    /* ============================================
       Scroll Indicator
       ============================================ */
    
    .scroll-indicator {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      padding: 8px 0 16px 0;
      opacity: 0.6;
      animation: bounce 2s ease-in-out infinite;
    }
    
    .scroll-indicator-text {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      letter-spacing: 0.02em;
    }
    
    .scroll-arrow {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--glass-bg);
      backdrop-filter: var(--blur-sm);
      -webkit-backdrop-filter: var(--blur-sm);
      border: 1.5px solid var(--glass-border);
      display: grid;
      place-items: center;
      font-size: 16px;
      color: var(--text-primary);
      box-shadow: var(--shadow-glass);
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }
    
    /* ============================================
       Utilities
       ============================================ */
    
    .badge {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 600;
      background: rgba(255, 255, 255, 0.5);
      backdrop-filter: var(--blur-sm);
      -webkit-backdrop-filter: var(--blur-sm);
      color: var(--text-primary);
      border: 1px solid rgba(255, 255, 255, 0.6);
      box-shadow: 0 2px 8px rgba(31, 38, 135, 0.08);
    }
    
    .text-gradient {
      background: linear-gradient(135deg, var(--accent), var(--accent-bright));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .action-panel {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 20px;
      padding: 24px 28px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .action-panel:hover {
      background: rgba(255, 255, 255, 0.4);
      transform: translateX(4px);
    }
    
    .action-panel:active {
      transform: scale(0.99);
    }
    
    .action-icon {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent-gradient-1), var(--accent-gradient-2));
      display: grid;
      place-items: center;
      font-size: 20px;
      font-weight: 600;
      color: white;
      box-shadow: 
        var(--shadow-glass),
        inset 0 1px 1px rgba(255, 255, 255, 0.3);
    }
    
    .action-icon.success {
      background: linear-gradient(135deg, #34c759, #30d158);
    }
    
    .action-icon.neutral {
      background: linear-gradient(135deg, #8e8e93, #636366);
    }
    
    .action-content h3 {
      margin: 0 0 4px 0;
      font-size: 17px;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .action-content p {
      margin: 0;
      font-size: 13px;
      color: var(--text-secondary);
    }
    
    .action-chevron {
      font-size: 20px;
      color: var(--text-tertiary);
      transition: transform 0.3s ease;
    }
    
    .action-panel:hover .action-chevron {
      transform: translateX(4px);
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 6px;
    }
    
    .status-dot.ok {
      background: var(--success);
      box-shadow: 0 0 8px rgba(52, 199, 89, 0.4);
    }
    
    .status-dot.warning {
      background: #f59e0b;
      box-shadow: 0 0 8px rgba(245, 158, 11, 0.4);
    }
  </style>
</head>
<body>
  <!-- Modern Display Corners -->
  <svg class="screen-corner top-left" viewBox="0 0 96 96" xmlns="http://www.w3.org/2000/svg">
    <path d="M 0,0 L 0,96 Q 0,0 96,0 L 0,0 Z" fill="black"/>
  </svg>
  
  <svg class="screen-corner top-right" viewBox="0 0 96 96" xmlns="http://www.w3.org/2000/svg">
    <path d="M 96,0 L 96,96 Q 96,0 0,0 L 96,0 Z" fill="black"/>
  </svg>
  
  <svg class="screen-corner bottom-left" viewBox="0 0 96 96" xmlns="http://www.w3.org/2000/svg">
    <path d="M 0,96 L 0,0 Q 0,96 96,96 L 0,96 Z" fill="black"/>
  </svg>
  
  <svg class="screen-corner bottom-right" viewBox="0 0 96 96" xmlns="http://www.w3.org/2000/svg">
    <path d="M 96,96 L 96,0 Q 96,96 0,96 L 96,96 Z" fill="black"/>
  </svg>
  
  <div class="app" id="app">
    <!-- Navigation -->
    <nav class="navbar">
      <div class="brand" id="brandTap">
        <img src="static/impactOS Logo.png" alt="impactOS" class="brand-logo">
        <div class="brand-text">instarinse<sup style="font-size: 10px;">®</sup></div>
      </div>
      
      <div class="nav-actions">
        <div class="location-info" style="margin-right: 24px;">
          <div class="location-label">Location</div>
          <div class="location-title">Business Design Centre</div>
        </div>
        <div style="display: flex; flex-direction: column; align-items: flex-end; margin-right: 24px;">
          <div id="navTime" style="font-size: 20px; font-weight: 600; color: var(--text-primary); letter-spacing: -0.02em;">00:00</div>
          <div id="navDate" style="font-size: 13px; font-weight: 500; color: var(--text-secondary); letter-spacing: 0.01em;">Monday, 1 Jan</div>
        </div>
        <button class="icon-btn" id="btnSettings" title="Settings" aria-label="Settings">⚙</button>
      </div>
    </nav>
    
    <!-- Main Content -->
    <main class="main">
      <div class="container">
        <!-- Status Banner -->
        <div class="status-banner" id="statusBanner">
          <div id="statusContent"></div>
        </div>
        
        <!-- Hero Metrics -->
        <div class="metrics-grid">
          <!-- Water Usage -->
          <div class="metric-card" data-metric="water-usage">
            <div class="metric-label">
              Water Usage
              <span class="cycle-badge" id="waterUsageBadge">+50mL</span>
            </div>
            <div class="metric-value" id="metricWaterUsage">0.00<small style="font-size: 24px; font-weight: 600; margin-left: 4px;">L</small></div>
          </div>
          
          <!-- Water Savings (alternating) -->
          <div class="metric-card alternating" data-metric="water-savings">
            <div class="metric-label" id="waterSavingsLabel">Water Saved vs Handwash</div>
            <div class="metric-value" id="metricWaterSavings">0.00<small style="font-size: 24px; font-weight: 600; margin-left: 4px;">L</small></div>
            <div style="font-size: 16px; font-weight: 600; margin-top: 8px; color: var(--success);" id="waterSavingsPercent">0% less water</div>
          </div>
          
          <!-- Energy Usage -->
          <div class="metric-card" data-metric="energy-usage">
            <div class="metric-label">
              Energy Usage
              <span class="cycle-badge" id="energyUsageBadge">+0.009kWh</span>
            </div>
            <div class="metric-value" id="metricEnergyUsage">0.000<small style="font-size: 24px; font-weight: 600; margin-left: 4px;">kWh</small></div>
          </div>
          
          <!-- Energy Savings (alternating) -->
          <div class="metric-card alternating" data-metric="energy-savings">
            <div class="metric-label" id="energySavingsLabel">Energy Saved vs Handwash</div>
            <div class="metric-value" id="metricEnergySavings">0.000<small style="font-size: 24px; font-weight: 600; margin-left: 4px;">kWh</small></div>
            <div style="font-size: 16px; font-weight: 600; margin-top: 8px; color: var(--success);" id="energySavingsPercent">0% less energy</div>
          </div>
          
          <!-- Paper Cups Saved -->
          <div class="metric-card" data-metric="cups">
            <div class="metric-label">Paper Cups Saved</div>
            <div class="metric-value" id="metricCups">0</div>
          </div>
          
          <!-- Cup Cost Saved -->
          <div class="metric-card" data-metric="cup-cost">
            <div class="metric-label">Cup Cost Saved</div>
            <div class="metric-value" id="metricCupCost">£0.00</div>
          </div>
        </div>
        
        <!-- Scroll Indicator -->
        <div class="scroll-indicator">
          <div class="scroll-indicator-text">More information below</div>
          <div class="scroll-arrow">↓</div>
        </div>
        
        <!-- Service & Reporting -->
        <div class="panel">
          <div class="panel-header">
            <h2 class="panel-title">Service & Reporting</h2>
          </div>
          
          <div class="action-panel" id="btnAnnualReport">
            <div class="action-icon">↓</div>
            <div class="action-content">
              <h3>Export Annual Report</h3>
              <p>Download comprehensive usage and savings data</p>
            </div>
            <div class="action-chevron">›</div>
          </div>
          
          <div class="action-panel" id="btnReportIssue">
            <div class="action-icon neutral">!</div>
            <div class="action-content">
              <h3>Report Issue</h3>
              <p>Contact support or log a maintenance request</p>
            </div>
            <div class="action-chevron">›</div>
          </div>
        </div>
        
        <!-- System Status -->
        <div class="panel">
          <div class="panel-header">
            <h2 class="panel-title">System Status</h2>
          </div>
          
          <div class="action-panel" id="btnCheckTanks">
            <div class="action-icon success">H₂O</div>
            <div class="action-content">
              <h3><span class="status-dot ok"></span>Water Tank</h3>
              <p>Last changed: <span id="tankLastChanged">8:13am</span> · Next change needed before <span id="tankNextChange">4:30pm</span></p>
            </div>
            <div class="action-chevron">›</div>
          </div>
          
          <div class="action-panel" id="btnCheckFilters">
            <div class="action-icon success">◎</div>
            <div class="action-content">
              <h3><span class="status-dot ok"></span>Filter Status</h3>
              <p>Condition: Good · Next service in 143 days</p>
            </div>
            <div class="action-chevron">›</div>
          </div>
        </div>
        
        <!-- Development Actions -->
        <div class="panel">
          <div class="panel-header">
            <h2 class="panel-title">Development</h2>
          </div>
          <div style="display: flex; gap: 12px; flex-wrap: wrap;">
            <button class="btn btn-secondary" id="btnExport">Export CSV</button>
            <button class="btn btn-secondary" id="btnReset">Reset Today</button>
            <button class="btn btn-primary" id="btnSimulator">Simulator: <span id="simStatus">Off</span></button>
          </div>
        </div>
      </div>
    </main>
  </div>
  
  <!-- Product Showcase (Left Side) -->
  <aside class="product-showcase" id="productShowcase">
    <div class="product-image-container">
      <img src="static/Render Freestanding.png" alt="instarinse® Machine" class="product-image">
      <div class="product-status-overlay" id="productStatusOverlay">
        <!-- Waveform or checkmark will be inserted here -->
      </div>
    </div>
    <div class="product-badge">
      25 second cycle · 50mL water · 0.009kWh
    </div>
  </aside>
  
  
  <!-- Settings Panel -->
  <aside class="settings-panel" id="settingsPanel">
    <div class="settings-header">
      <div style="display: flex; align-items: center; gap: 12px;">
        <h2 class="settings-title">Settings</h2>
        <div class="version-badge">v1.3.4</div>
      </div>
      <button class="btn-text" id="btnCloseSettings">Done</button>
    </div>
    
    <div class="settings-body">
      <div class="form-section">
        <h3 class="form-section-title">Handwash Baselines (per cup)</h3>
        <div class="form-row">
          <label class="form-label" for="baselineWater">Water (mL)</label>
          <input type="number" class="form-input" id="baselineWater" min="0" step="10" />
        </div>
        <div class="form-row">
          <label class="form-label" for="baselineEnergy">Energy (kWh)</label>
          <input type="number" class="form-input" id="baselineEnergy" min="0" step="0.001" />
        </div>
      </div>
      
      <div class="form-section">
        <h3 class="form-section-title">Dishwasher Baselines (per cup)</h3>
        <div class="form-row">
          <label class="form-label" for="dishwasherWater">Water (mL)</label>
          <input type="number" class="form-input" id="dishwasherWater" min="0" step="10" />
        </div>
        <div class="form-row">
          <label class="form-label" for="dishwasherEnergy">Energy (kWh)</label>
          <input type="number" class="form-input" id="dishwasherEnergy" min="0" step="0.001" />
        </div>
      </div>
      
      <div class="form-section">
        <h3 class="form-section-title">Other Settings</h3>
        <div class="form-row">
          <label class="form-label" for="baselineTime">Manual time (seconds)</label>
          <input type="number" class="form-input" id="baselineTime" min="0" step="5" />
        </div>
        <div class="form-row">
          <label class="form-label" for="cupCost">Cup cost (£)</label>
          <input type="number" class="form-input" id="cupCost" min="0" step="0.01" />
        </div>
      </div>
      
      <div class="form-section">
        <h3 class="form-section-title">Tariffs</h3>
        <div class="form-row">
          <label class="form-label" for="tariffWater">Water (£/m³)</label>
          <input type="number" class="form-input" id="tariffWater" min="0" step="0.1" />
        </div>
        <div class="form-row">
          <label class="form-label" for="tariffEnergy">Energy (£/kWh)</label>
          <input type="number" class="form-input" id="tariffEnergy" min="0" step="0.01" />
        </div>
        <div class="form-row">
          <label class="form-label" for="tariffStaff">Staff (£/hour)</label>
          <input type="number" class="form-input" id="tariffStaff" min="0" step="0.5" />
        </div>
      </div>
      
      <div class="form-section">
        <h3 class="form-section-title">Simulator</h3>
        <div class="form-row">
          <label class="form-label" for="simCyclesPerHour">Cycles per hour</label>
          <input type="number" class="form-input" id="simCyclesPerHour" min="1" max="120" step="1" />
        </div>
      </div>
      
      <div class="form-section">
        <h3 class="form-section-title">PIN Protection</h3>
        <div class="form-row">
          <label class="form-label" for="pinInput">Enter PIN (default: 2468)</label>
          <input type="password" class="form-input" id="pinInput" inputmode="numeric" pattern="[0-9]*" placeholder="••••" />
        </div>
      </div>
    </div>
    
    <div class="settings-footer">
      <button class="btn btn-secondary" id="btnRestore">Restore Defaults</button>
      <button class="btn btn-primary" id="btnSave">Save Changes</button>
    </div>
  </aside>
  
  <!-- Toast -->
  <div class="toast" id="toast">Saved</div>

  <script>
    
    const DEVICE = {
      cycleTime: 25,         // 25 seconds per cycle
      waterUsage: 50,        // ~50 mL per cycle
      energyUsage: 0.009,    // ~0.009 kWh per cycle
    };
    
    const BASELINES = {
      handwash: {
        water: 1000,        // 1L per cup
        energy: 0.08,       // 0.08kWh per cup
      },
      dishwash: {
        water: 250,         // 250ml per cup
        energy: 0.032,      // 0.032kWh per cup
      }
    };
    
    const CUP_COST = 0.30;
    
    const DEFAULT_CONFIG = {
      baselines: { handWashWater: 1000, handWashEnergy: 0.05, manualTime: 45 },
      tariffs: { water: 2.50, energy: 0.30, staff: 15.00 },
      simulator: { cyclesPerHour: 30 },
      pin: '2468',
    };
    
    
    class DashboardState {
      constructor() {
        this.config = { ...DEFAULT_CONFIG };
        this.cycles = [];
        this.totals = {
          water: 0,
          energy: 0,
          time: 0,
          cost: 0,
        };
        this.sessionDate = new Date().toDateString();
        this.unlocked = false;
        this.load();
      }
      
      load() {
        try {
          const stored = localStorage.getItem('instarinse_dashboard_v2');
          if (stored) {
            const data = JSON.parse(stored);
            // Check if we need to reset (new day)
            if (data.sessionDate !== new Date().toDateString()) {
              this.reset();
            } else {
              this.cycles = data.cycles || [];
              this.totals = data.totals || this.totals;
              this.config = { ...DEFAULT_CONFIG, ...data.config };
            }
          }
        } catch (e) {
          console.error('Failed to load state:', e);
        }
      }
      
      save() {
        try {
          localStorage.setItem('instarinse_dashboard_v2', JSON.stringify({
            sessionDate: this.sessionDate,
            cycles: this.cycles,
            totals: this.totals,
            config: this.config,
          }));
        } catch (e) {
          console.error('Failed to save state:', e);
        }
      }
      
      reset() {
        this.cycles = [];
        this.totals = { water: 0, energy: 0, time: 0, cost: 0 };
        this.sessionDate = new Date().toDateString();
        this.save();
      }
      
      addCycle(cycle) {
        this.cycles.push(cycle);
        this.totals.water += cycle.savings.water;
        this.totals.energy += cycle.savings.energy;
        this.totals.time += cycle.savings.time;
        this.totals.cost += cycle.savings.cost;
        this.save();
      }
      
      calculateSavings() {
        const waterSaved = (this.config.baselines.handWashWater - DEVICE.waterUsage) / 1000; // Convert to litres
        const energySaved = this.config.baselines.handWashEnergy - DEVICE.energyUsage;
        const timeSaved = (this.config.baselines.manualTime - DEVICE.cycleTime) / 3600; // Convert to hours
        
        const waterCost = waterSaved * this.config.tariffs.water;
        const energyCost = energySaved * this.config.tariffs.energy;
        const timeCost = timeSaved * this.config.tariffs.staff;
        const totalCost = waterCost + energyCost + timeCost;
        
        return {
          water: Math.max(0, waterSaved),
          energy: Math.max(0, energySaved),
          time: Math.max(0, timeSaved),
          cost: Math.max(0, totalCost),
        };
      }
    }
    
    
    class DashboardUI {
      constructor(state) {
        this.state = state;
        this.elements = this.getElements();
        this.simulatorInterval = null;
        this.comparisonMode = 'handwash'; // 'handwash' or 'dishwash'
        this.alternateInterval = null;
        this.tapCount = 0;
        this.tapTimer = null;
        this.bindEvents();
        this.render();
        this.startClock();
        this.startAlternating();
        
        // Start with product showcase visible
        document.getElementById('productShowcase').classList.add('show');
        document.getElementById('app').classList.add('with-product-view');
        
        // Show idle state on product
        setTimeout(() => {
          const overlay = document.getElementById('productStatusOverlay');
          if (overlay) {
            this.showProductIdle();
          }
        }, 100);
      }
      
      getElements() {
        return {
          // New Metrics
          metricWaterUsage: document.getElementById('metricWaterUsage'),
          metricWaterSavings: document.getElementById('metricWaterSavings'),
          waterSavingsLabel: document.getElementById('waterSavingsLabel'),
          waterSavingsPercent: document.getElementById('waterSavingsPercent'),
          
          metricEnergyUsage: document.getElementById('metricEnergyUsage'),
          metricEnergySavings: document.getElementById('metricEnergySavings'),
          energySavingsLabel: document.getElementById('energySavingsLabel'),
          energySavingsPercent: document.getElementById('energySavingsPercent'),
          
          metricCups: document.getElementById('metricCups'),
          metricCupCost: document.getElementById('metricCupCost'),
          
          // Clock
          navTime: document.getElementById('navTime'),
          navDate: document.getElementById('navDate'),
          
          // Status
          statusBanner: document.getElementById('statusBanner'),
          
          // Controls
          btnSettings: document.getElementById('btnSettings'),
          btnSimulator: document.getElementById('btnSimulator'),
          btnExport: document.getElementById('btnExport'),
          btnReset: document.getElementById('btnReset'),
          simStatus: document.getElementById('simStatus'),
          
          // Settings
          settingsPanel: document.getElementById('settingsPanel'),
          btnCloseSettings: document.getElementById('btnCloseSettings'),
          btnSave: document.getElementById('btnSave'),
          btnRestore: document.getElementById('btnRestore'),
          baselineWater: document.getElementById('baselineWater'),
          baselineEnergy: document.getElementById('baselineEnergy'),
          dishwasherWater: document.getElementById('dishwasherWater'),
          dishwasherEnergy: document.getElementById('dishwasherEnergy'),
          baselineTime: document.getElementById('baselineTime'),
          cupCost: document.getElementById('cupCost'),
          tariffWater: document.getElementById('tariffWater'),
          tariffEnergy: document.getElementById('tariffEnergy'),
          tariffStaff: document.getElementById('tariffStaff'),
          simCyclesPerHour: document.getElementById('simCyclesPerHour'),
          pinInput: document.getElementById('pinInput'),
          
          // Toast
          toast: document.getElementById('toast'),
          
          // Brand tap
          brandTap: document.getElementById('brandTap'),
        };
      }
      
      bindEvents() {
        // Settings
        this.elements.btnSettings.addEventListener('click', () => this.openSettings());
        this.elements.btnCloseSettings.addEventListener('click', () => this.closeSettings());
        this.elements.btnSave.addEventListener('click', () => this.saveSettings());
        this.elements.btnRestore.addEventListener('click', () => this.restoreDefaults());
        
        // PIN unlock
        this.elements.pinInput.addEventListener('input', () => this.checkPin());
        
        // Actions
        this.elements.btnSimulator.addEventListener('click', () => this.toggleSimulator());
        this.elements.btnExport.addEventListener('click', () => this.exportData());
        this.elements.btnReset.addEventListener('click', () => this.resetDay());
        
        // Customer action panels
        document.getElementById('btnAnnualReport').addEventListener('click', () => this.exportAnnualReport());
        document.getElementById('btnReportIssue').addEventListener('click', () => this.reportIssue());
        document.getElementById('btnCheckTanks').addEventListener('click', () => this.checkTanks());
        document.getElementById('btnCheckFilters').addEventListener('click', () => this.checkFilters());
        
        // Double-tap brand to open settings
        this.elements.brandTap.addEventListener('click', () => this.handleBrandTap());
      }
      
      handleBrandTap() {
        this.tapCount++;
        clearTimeout(this.tapTimer);
        this.tapTimer = setTimeout(() => this.tapCount = 0, 500);
        if (this.tapCount >= 2) {
          this.openSettings();
          this.tapCount = 0;
        }
      }
      
      openSettings() {
        this.loadSettingsForm();
        this.elements.settingsPanel.classList.add('open');
      }
      
      closeSettings() {
        this.elements.settingsPanel.classList.remove('open');
        this.elements.pinInput.value = '';
        this.state.unlocked = false;
      }
      
      loadSettingsForm() {
        this.elements.baselineWater.value = BASELINES.handwash.water;
        this.elements.baselineEnergy.value = BASELINES.handwash.energy;
        this.elements.dishwasherWater.value = BASELINES.dishwash.water;
        this.elements.dishwasherEnergy.value = BASELINES.dishwash.energy;
        this.elements.baselineTime.value = this.state.config.baselines.manualTime;
        this.elements.cupCost.value = CUP_COST;
        this.elements.tariffWater.value = this.state.config.tariffs.water;
        this.elements.tariffEnergy.value = this.state.config.tariffs.energy;
        this.elements.tariffStaff.value = this.state.config.tariffs.staff;
        this.elements.simCyclesPerHour.value = this.state.config.simulator.cyclesPerHour;
      }
      
      checkPin() {
        if (this.elements.pinInput.value === this.state.config.pin) {
          this.state.unlocked = true;
          this.showToast('Unlocked ✓');
        }
      }
      
      saveSettings() {
        if (!this.state.unlocked) {
          this.showToast('Please enter PIN to unlock');
          return;
        }
        
        BASELINES.handwash.water = parseFloat(this.elements.baselineWater.value) || 1000;
        BASELINES.handwash.energy = parseFloat(this.elements.baselineEnergy.value) || 0.08;
        BASELINES.dishwash.water = parseFloat(this.elements.dishwasherWater.value) || 250;
        BASELINES.dishwash.energy = parseFloat(this.elements.dishwasherEnergy.value) || 0.032;
        
        this.state.config.baselines.handWashWater = BASELINES.handwash.water;
        this.state.config.baselines.handWashEnergy = BASELINES.handwash.energy;
        this.state.config.baselines.manualTime = parseFloat(this.elements.baselineTime.value) || DEFAULT_CONFIG.baselines.manualTime;
        this.state.config.tariffs.water = parseFloat(this.elements.tariffWater.value) || DEFAULT_CONFIG.tariffs.water;
        this.state.config.tariffs.energy = parseFloat(this.elements.tariffEnergy.value) || DEFAULT_CONFIG.tariffs.energy;
        this.state.config.tariffs.staff = parseFloat(this.elements.tariffStaff.value) || DEFAULT_CONFIG.tariffs.staff;
        this.state.config.simulator.cyclesPerHour = parseInt(this.elements.simCyclesPerHour.value) || DEFAULT_CONFIG.simulator.cyclesPerHour;
        
        this.state.save();
        this.render();
        this.showToast('Settings saved');
        this.closeSettings();
      }
      
      restoreDefaults() {
        if (!this.state.unlocked) {
          this.showToast('Please enter PIN to unlock');
          return;
        }
        
        BASELINES.handwash.water = 1000;
        BASELINES.handwash.energy = 0.08;
        BASELINES.dishwash.water = 250;
        BASELINES.dishwash.energy = 0.032;
        
        this.state.config = { ...DEFAULT_CONFIG };
        this.loadSettingsForm();
        this.render();
        this.showToast('Defaults restored');
      }
      
      showToast(message) {
        this.elements.toast.textContent = message;
        this.elements.toast.classList.add('show');
        setTimeout(() => {
          this.elements.toast.classList.remove('show');
        }, 2000);
      }
      
      toggleSimulator() {
        if (this.simulatorInterval) {
          this.stopSimulator();
        } else {
          this.startSimulator();
        }
      }
      
      startSimulator() {
        const intervalMs = (3600 / this.state.config.simulator.cyclesPerHour) * 1000;
        this.simulatorInterval = setInterval(() => this.runCycle(), intervalMs);
        this.elements.simStatus.textContent = 'On';
        this.showToast('Simulator started');
      }
      
      stopSimulator() {
        if (this.simulatorInterval) {
          clearInterval(this.simulatorInterval);
          this.simulatorInterval = null;
        }
        this.elements.simStatus.textContent = 'Off';
        this.showToast('Simulator stopped');
      }
      
      async runCycle() {
        // Show waveform on product
        this.showProductWaveform();
        
        // Simulate cycle duration
        const duration = DEVICE.cycleTime + (Math.random() * 4 - 2); // 23-27 seconds
        
        await this.sleep(duration * 1000);
        
        // Calculate savings
        const savings = this.state.calculateSavings();
        
        // Create cycle record
        const cycle = {
          timestamp: Date.now(),
          duration: duration,
          waterUsed: DEVICE.waterUsage + (Math.random() * 4 - 2), // 48-52 mL
          energyUsed: DEVICE.energyUsage + (Math.random() * 0.002 - 0.001), // ~0.008-0.010 kWh
          savings: savings,
        };
        
        // Add to state
        this.state.addCycle(cycle);
        
        // Show checkmark - keep visible for 3 seconds
        this.showProductCheckmark();
        setTimeout(() => {
          this.hideProductStatus();
        }, 3000);
        
        // Update UI
        this.render();
        this.animateDelta(savings);
      }
      
      showRunningStatus() {
        const statusContent = document.getElementById('statusContent');
        statusContent.innerHTML = `
          <div class="waveform">
            <div class="waveform-bar"></div>
            <div class="waveform-bar"></div>
            <div class="waveform-bar"></div>
            <div class="waveform-bar"></div>
            <div class="waveform-bar"></div>
            <div class="waveform-bar"></div>
            <div class="waveform-bar"></div>
            <div class="waveform-bar"></div>
            <div class="waveform-bar"></div>
            <div class="waveform-bar"></div>
          </div>
          <div class="status-text" id="cycleStatusText">Cycle running...</div>
          <div class="status-subtext" id="cycleSubtext">Cleaning in progress</div>
        `;
        this.elements.statusBanner.classList.add('active', 'running');
        this.elements.statusBanner.classList.remove('success');
      }
      
      updateCycleCountdown(seconds) {
        const subtextEl = document.getElementById('cycleSubtext');
        if (subtextEl) {
          subtextEl.textContent = `${seconds}s remaining`;
        }
      }
      
      showSuccessStatus(savings) {
        const statusContent = document.getElementById('statusContent');
        statusContent.innerHTML = `
          <div class="success-icon">✓</div>
          <div class="status-text">Cycle Complete!</div>
          <div class="status-subtext">
            Saved ${savings.water.toFixed(2)}L water · 
            ${savings.energy.toFixed(3)}kWh energy · 
            ${(savings.time * 60).toFixed(1)} minutes · 
            £${savings.cost.toFixed(2)}
          </div>
        `;
        this.elements.statusBanner.classList.remove('running');
        this.elements.statusBanner.classList.add('success');
      }
      
      hideStatus() {
        this.elements.statusBanner.classList.remove('active', 'success', 'running');
      }
      
      showProductIdle() {
        const overlay = document.getElementById('productStatusOverlay');
        if (!overlay.querySelector('.product-waveform')) {
          overlay.innerHTML = `
            <div class="product-waveform">
              <div class="product-wave-bar idle"></div>
              <div class="product-wave-bar idle"></div>
              <div class="product-wave-bar idle"></div>
              <div class="product-wave-bar idle"></div>
              <div class="product-wave-bar idle"></div>
              <div class="product-wave-bar idle"></div>
              <div class="product-wave-bar idle"></div>
              <div class="product-wave-bar idle"></div>
              <div class="product-wave-bar idle"></div>
            </div>
            <div class="product-status-text">Idle</div>
          `;
        } else {
          const bars = overlay.querySelectorAll('.product-wave-bar');
          bars.forEach(bar => {
            bar.classList.remove('active');
            bar.classList.add('idle');
          });
          const text = overlay.querySelector('.product-status-text');
          if (text) text.textContent = 'Idle';
        }
      }
      
      showProductWaveform() {
        const overlay = document.getElementById('productStatusOverlay');
        if (!overlay.querySelector('.product-waveform')) {
          overlay.innerHTML = `
            <div class="product-waveform">
              <div class="product-wave-bar active"></div>
              <div class="product-wave-bar active"></div>
              <div class="product-wave-bar active"></div>
              <div class="product-wave-bar active"></div>
              <div class="product-wave-bar active"></div>
              <div class="product-wave-bar active"></div>
              <div class="product-wave-bar active"></div>
              <div class="product-wave-bar active"></div>
              <div class="product-wave-bar active"></div>
            </div>
            <div class="product-status-text">Rinsing</div>
          `;
        } else {
          const bars = overlay.querySelectorAll('.product-wave-bar');
          bars.forEach(bar => {
            bar.classList.remove('idle');
            bar.classList.add('active');
          });
          const text = overlay.querySelector('.product-status-text');
          if (text) text.textContent = 'Rinsing';
        }
      }
      
      showProductCheckmark() {
        const overlay = document.getElementById('productStatusOverlay');
        overlay.innerHTML = `
          <div class="product-checkmark">
            <div class="check-circle"></div>
            <div class="check-path">
              <svg viewBox="0 0 24 24">
                <path d="M6 12l4 4 8-8"/>
              </svg>
            </div>
          </div>
          <div class="product-status-text">Complete</div>
        `;
      }
      
      hideProductStatus() {
        // Return to idle state instead of hiding
        this.showProductIdle();
      }
      
      animateDelta(savings) {
        // Highlight cards
        const cards = document.querySelectorAll('.metric-card');
        cards.forEach(card => {
          card.classList.add('highlight');
          setTimeout(() => card.classList.remove('highlight'), 1000);
        });
        
        // Show usage badges
        const waterBadge = document.getElementById('waterUsageBadge');
        const energyBadge = document.getElementById('energyUsageBadge');
        
        if (waterBadge) {
          waterBadge.textContent = `+${DEVICE.waterUsage}mL`;
          waterBadge.classList.add('show');
          setTimeout(() => waterBadge.classList.remove('show'), 3000);
        }
        
        if (energyBadge) {
          energyBadge.textContent = `+${DEVICE.energyUsage.toFixed(3)}kWh`;
          energyBadge.classList.add('show');
          setTimeout(() => energyBadge.classList.remove('show'), 3000);
        }
      }
      
      render() {
        const numCycles = this.state.cycles.length;
        
        // Calculate totals
        const totalWaterUsed = (numCycles * DEVICE.waterUsage) / 1000; // Convert to litres
        const totalEnergyUsed = numCycles * DEVICE.energyUsage;
        
        // Update usage metrics
        this.elements.metricWaterUsage.innerHTML = `${totalWaterUsed.toFixed(2)}<small style="font-size: 24px; font-weight: 600; margin-left: 4px;">L</small>`;
        this.elements.metricEnergyUsage.innerHTML = `${totalEnergyUsed.toFixed(3)}<small style="font-size: 24px; font-weight: 600; margin-left: 4px;">kWh</small>`;
        
        // Update cup metrics
        this.elements.metricCups.textContent = numCycles.toString();
        this.elements.metricCupCost.textContent = `£${(numCycles * CUP_COST).toFixed(2)}`;
        
        // Update savings based on current comparison mode
        this.updateSavingsDisplay();
        
        // Update tank prediction
        this.updateTankPrediction();
      }
      
      updateSavingsDisplay() {
        const numCycles = this.state.cycles.length;
        const baseline = BASELINES[this.comparisonMode];
        const label = this.comparisonMode === 'handwash' ? 'Water Saved vs Handwash' : 'Water Saved vs Dishwasher';
        const energyLabel = this.comparisonMode === 'handwash' ? 'Energy Saved vs Handwash' : 'Energy Saved vs Dishwasher';
        
        // Water savings
        const baselineWaterTotal = (numCycles * baseline.water) / 1000; // L
        const actualWaterUsed = (numCycles * DEVICE.waterUsage) / 1000; // L
        const waterSaved = baselineWaterTotal - actualWaterUsed;
        const waterPercent = baselineWaterTotal > 0 ? ((waterSaved / baselineWaterTotal) * 100) : 0;
        
        this.elements.waterSavingsLabel.textContent = label;
        this.elements.metricWaterSavings.innerHTML = `${waterSaved.toFixed(2)}<small style="font-size: 24px; font-weight: 600; margin-left: 4px;">L</small>`;
        this.elements.waterSavingsPercent.textContent = `${Math.round(waterPercent)}% less water`;
        
        // Energy savings
        const baselineEnergyTotal = numCycles * baseline.energy; // kWh
        const actualEnergyUsed = numCycles * DEVICE.energyUsage; // kWh
        const energySaved = baselineEnergyTotal - actualEnergyUsed;
        const energyPercent = baselineEnergyTotal > 0 ? ((energySaved / baselineEnergyTotal) * 100) : 0;
        
        this.elements.energySavingsLabel.textContent = energyLabel;
        this.elements.metricEnergySavings.innerHTML = `${energySaved.toFixed(3)}<small style="font-size: 20px; font-weight: 600; margin-left: 4px;">kWh</small>`;
        this.elements.energySavingsPercent.textContent = `${Math.round(energyPercent)}% less energy`;
      }
      
      startAlternating() {
        this.alternateInterval = setInterval(() => {
          // Start blur transition
          const savingsCards = document.querySelectorAll('.metric-card.alternating');
          savingsCards.forEach(card => card.classList.add('transitioning'));
          
          // After blur, switch mode
          setTimeout(() => {
            this.comparisonMode = this.comparisonMode === 'handwash' ? 'dishwash' : 'handwash';
            this.updateSavingsDisplay();
            
            // Remove blur
            savingsCards.forEach(card => card.classList.remove('transitioning'));
          }, 1000);
        }, 10000);
      }
      
      startClock() {
        const updateClock = () => {
          const now = new Date();
          const hours = now.getHours().toString().padStart(2, '0');
          const minutes = now.getMinutes().toString().padStart(2, '0');
          this.elements.navTime.textContent = `${hours}:${minutes}`;
          
          const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
          const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
          const dayName = days[now.getDay()];
          const day = now.getDate();
          const month = months[now.getMonth()];
          this.elements.navDate.textContent = `${dayName}, ${day} ${month}`;
        };
        
        updateClock();
        setInterval(updateClock, 1000);
      }
      
      
      exportData() {
        if (this.state.cycles.length === 0) {
          this.showToast('No data to export');
          return;
        }
        
        const headers = ['Timestamp', 'Duration (s)', 'Water Used (mL)', 'Energy Used (kWh)', 'Water Saved (L)', 'Energy Saved (kWh)', 'Time Saved (hrs)', 'Cost Saved (£)'];
        const rows = this.state.cycles.map(c => [
          new Date(c.timestamp).toISOString(),
          c.duration.toFixed(1),
          c.waterUsed.toFixed(1),
          c.energyUsed.toFixed(4),
          c.savings.water.toFixed(3),
          c.savings.energy.toFixed(4),
          c.savings.time.toFixed(4),
          c.savings.cost.toFixed(2),
        ]);
        
        const csv = [headers, ...rows].map(row => row.join(',')).join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `instarinse-data-${new Date().toISOString().split('T')[0]}.csv`;
        a.click();
        URL.revokeObjectURL(url);
        
        this.showToast('Data exported');
      }
      
      resetDay() {
        if (confirm('Reset all data for today? This cannot be undone.')) {
          this.stopSimulator();
          this.state.reset();
          this.render();
          this.showToast('Day reset');
          this.showProductIdle();
        }
      }
      
      exportAnnualReport() {
        this.showToast('Annual report feature coming soon');
        // Future: Generate comprehensive PDF or detailed CSV
      }
      
      reportIssue() {
        this.showToast('Support contact feature coming soon');
        // Future: Open support form or email link
      }
      
      checkTanks() {
        this.showToast('Tank monitoring interface coming soon');
        // Future: Show detailed tank levels and history
      }
      
      updateTankPrediction() {
        // AI-driven prediction based on usage patterns
        const numCycles = this.state.cycles.length;
        
        if (numCycles > 0) {
          // Calculate cycles per hour
          const firstCycle = this.state.cycles[0].timestamp;
          const lastCycle = this.state.cycles[this.state.cycles.length - 1].timestamp;
          const hoursDiff = (lastCycle - firstCycle) / (1000 * 60 * 60);
          const cyclesPerHour = hoursDiff > 0 ? this.state.cycles.length / hoursDiff : 10;
          
          // Assume tank holds ~200 cycles worth of water
          const tankCapacity = 200;
          const currentLevel = 85; // 85%
          const cyclesRemaining = (tankCapacity * currentLevel) / 100;
          
          // Predict hours until empty
          const hoursUntilEmpty = cyclesRemaining / Math.max(cyclesPerHour, 5);
          
          // Calculate next change time
          const now = new Date();
          const changeTime = new Date(now.getTime() + hoursUntilEmpty * 60 * 60 * 1000);
          const hours = changeTime.getHours();
          const minutes = changeTime.getMinutes().toString().padStart(2, '0');
          const period = hours >= 12 ? 'pm' : 'am';
          const displayHours = hours % 12 || 12;
          
          const nextChangeEl = document.getElementById('tankNextChange');
          if (nextChangeEl) {
            nextChangeEl.textContent = `${displayHours}:${minutes}${period}`;
          }
        }
      }
      
      checkFilters() {
        this.showToast('Filter maintenance tracker coming soon');
        // Future: Show filter condition, service history
      }
      
      sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }
    }
    
    const state = new DashboardState();
    const ui = new DashboardUI(state);
  </script>
</body>
</html>

